/*!
 * @pixi/compressed-textures - v6.3.0
 * Compiled Wed, 23 Mar 2022 18:58:56 UTC
 *
 * @pixi/compressed-textures is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{ViewableBuffer as _,BufferResource as R,Texture as e,BaseTexture as T}from"@pixi/core";import{LoaderResource as t}from"@pixi/loaders";import{url as E}from"@pixi/utils";import{MIPMAP_MODES as G,ALPHA_MODES as r,TYPES as O,FORMATS as A}from"@pixi/constants";var D,M;!function(_){_[_.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",_[_.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",_[_.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",_[_.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",_[_.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",_[_.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",_[_.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",_[_.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",_[_.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",_[_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",_[_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",_[_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",_[_.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",_[_.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",_[_.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",_[_.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",_[_.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",_[_.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",_[_.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",_[_.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(M||(M={}));var S=((D={})[M.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,D[M.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,D[M.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,D[M.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,D[M.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,D[M.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,D[M.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,D[M.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,D[M.COMPRESSED_R11_EAC]=.5,D[M.COMPRESSED_SIGNED_R11_EAC]=.5,D[M.COMPRESSED_RG11_EAC]=1,D[M.COMPRESSED_SIGNED_RG11_EAC]=1,D[M.COMPRESSED_RGB8_ETC2]=.5,D[M.COMPRESSED_RGBA8_ETC2_EAC]=1,D[M.COMPRESSED_SRGB8_ETC2]=.5,D[M.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,D[M.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,D[M.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,D[M.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,D[M.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,D[M.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,D[M.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,D[M.COMPRESSED_RGB_ETC1_WEBGL]=.5,D[M.COMPRESSED_RGB_ATC_WEBGL]=.5,D[M.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,D[M.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,D),n=function(_,R){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,R){_.__proto__=R}||function(_,R){for(var e in R)R.hasOwnProperty(e)&&(_[e]=R[e])})(_,R)};function I(_,R){function e(){this.constructor=_}n(_,R),_.prototype=null===R?Object.create(R):(e.prototype=R.prototype,new e)}function X(_,R){var e,T,t,E,G={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return E={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(E[Symbol.iterator]=function(){return this}),E;function r(E){return function(r){return function(E){if(e)throw new TypeError("Generator is already executing.");for(;G;)try{if(e=1,T&&(t=2&E[0]?T.return:E[0]?T.throw||((t=T.return)&&t.call(T),0):T.next)&&!(t=t.call(T,E[1])).done)return t;switch(T=0,t&&(E=[2&E[0],t.value]),E[0]){case 0:case 1:t=E;break;case 4:return G.label++,{value:E[1],done:!1};case 5:G.label++,T=E[1],E=[0];continue;case 7:E=G.ops.pop(),G.trys.pop();continue;default:if(!(t=(t=G.trys).length>0&&t[t.length-1])&&(6===E[0]||2===E[0])){G=0;continue}if(3===E[0]&&(!t||E[1]>t[0]&&E[1]<t[3])){G.label=E[1];break}if(6===E[0]&&G.label<t[1]){G.label=t[1],t=E;break}if(t&&G.label<t[2]){G.label=t[2],G.ops.push(E);break}t[2]&&G.ops.pop(),G.trys.pop();continue}E=R.call(_,G)}catch(_){E=[6,_],T=0}finally{e=t=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([E,r])}}}var o,a,F=function(R){function e(e,T){void 0===T&&(T={width:1,height:1,autoLoad:!0});var t,E,G=this;return"string"==typeof e?(t=e,E=new Uint8Array):(t=null,E=e),(G=R.call(this,E,T)||this).origin=t,G.buffer=E?new _(E):null,G.origin&&!1!==T.autoLoad&&G.load(),E&&E.length&&(G.loaded=!0,G.onBlobLoaded(G.buffer.rawBinaryData)),G}return I(e,R),e.prototype.onBlobLoaded=function(_){},e.prototype.load=function(){return R=this,e=void 0,T=Promise,t=function(){var R;return X(this,function(e){switch(e.label){case 0:return[4,fetch(this.origin)];case 1:return[4,e.sent().blob()];case 2:return[4,e.sent().arrayBuffer()];case 3:return R=e.sent(),this.data=new Uint32Array(R),this.buffer=new _(R),this.loaded=!0,this.onBlobLoaded(R),this.update(),[2,this]}})},new(T||(T=Promise))(function(_,E){function G(_){try{O(t.next(_))}catch(_){E(_)}}function r(_){try{O(t.throw(_))}catch(_){E(_)}}function O(R){R.done?_(R.value):new T(function(_){_(R.value)}).then(G,r)}O((t=t.apply(R,e||[])).next())});var R,e,T,t},e}(R),B=function(_){function R(e,T){var t=_.call(this,e,T)||this;return t.format=T.format,t.levels=T.levels||1,t._width=T.width,t._height=T.height,t._extension=R._formatToExtension(t.format),(T.levelBuffers||t.buffer)&&(t._levelBuffers=T.levelBuffers||R._createLevelBuffers(e instanceof Uint8Array?e:t.buffer.uint8View,t.format,t.levels,4,4,t.width,t.height)),t}return I(R,_),R.prototype.upload=function(_,R,e){var T=_.gl;if(!_.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var t=0,E=this.levels;t<E;t++){var G=this._levelBuffers[t],r=G.levelID,O=G.levelWidth,A=G.levelHeight,D=G.levelBuffer;T.compressedTexImage2D(T.TEXTURE_2D,r,this.format,O,A,0,D)}return!0},R.prototype.onBlobLoaded=function(){this._levelBuffers=R._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},R._formatToExtension=function(_){if(_>=33776&&_<=33779)return"s3tc";if(_>=37488&&_<=37497)return"etc";if(_>=35840&&_<=35843)return"pvrtc";if(_>=36196)return"etc1";if(_>=35986&&_<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},R._createLevelBuffers=function(_,R,e,T,t,E,G){for(var r=new Array(e),O=_.byteOffset,A=E,D=G,M=A+T-1&~(T-1),n=D+t-1&~(t-1),I=M*n*S[R],X=0;X<e;X++)r[X]={levelID:X,levelWidth:e>1?A:M,levelHeight:e>1?D:n,levelBuffer:new Uint8Array(_.buffer,O,I)},O+=I,I=(M=(A=A>>1||1)+T-1&~(T-1))*(n=(D=D>>1||1)+t-1&~(t-1))*S[R];return r},R}(F),i=function(){function _(){}return _.use=function(R,e){var T=R.data;if(R.type===t.TYPE.JSON&&T&&T.cacheID&&T.textures){for(var G=T.textures,r=void 0,O=void 0,A=0,D=G.length;A<D;A++){var M=G[A],S=M.src,n=M.format;if(n||(O=S),_.textureFormats[n]){r=S;break}}if(!(r=r||O))return void e(new Error("Cannot load compressed-textures in "+R.url+", make sure you provide a fallback"));if(r===R.url)return void e(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var I={crossOrigin:R.crossOrigin,metadata:R.metadata.imageMetadata,parentResource:R},X=E.resolve(R.url.replace(this.baseUrl,""),r),o=T.cacheID;this.add(o,X,I,function(_){if(_.error)e(_.error);else{var T=_.texture,t=void 0===T?null:T,E=_.textures,G=void 0===E?{}:E;Object.assign(R,{texture:t,textures:G}),e()}})}else e()},_.add=function(){var R=document.createElement("canvas").getContext("webgl");if(R){var e={s3tc:R.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:R.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:R.getExtension("WEBGL_compressed_texture_etc"),etc1:R.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:R.getExtension("WEBGL_compressed_texture_pvrtc")||R.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:R.getExtension("WEBGL_compressed_texture_atc"),astc:R.getExtension("WEBGL_compressed_texture_astc")};for(var T in _.textureExtensions=e,_.textureFormats={},e){var t=e[T];t&&Object.assign(_.textureFormats,Object.getPrototypeOf(t))}}},_}();function P(_,R,t){var E={textures:{},texture:null};return R?(R.map(function(_){return new e(new T(_,Object.assign({mipmap:G.OFF,alphaMode:r.NO_PREMULTIPLIED_ALPHA},t)))}).forEach(function(R,t){var G=R.baseTexture,r=_+"-"+(t+1);T.addToCache(G,r),e.addToCache(R,r),0===t&&(T.addToCache(G,_),e.addToCache(R,_),E.texture=R),E.textures[r]=R}),E):E}t.setExtensionXhrType("dds",t.XHR_RESPONSE_TYPE.BUFFER);var C,s,u=3,f=4,N=7,l=19,U=2,c=0,L=1,d=2,h=3;!function(_){_[_.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",_[_.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",_[_.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",_[_.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",_[_.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",_[_.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",_[_.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",_[_.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",_[_.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",_[_.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",_[_.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",_[_.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",_[_.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",_[_.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",_[_.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",_[_.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",_[_.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",_[_.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",_[_.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",_[_.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",_[_.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",_[_.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",_[_.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",_[_.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",_[_.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",_[_.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",_[_.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",_[_.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",_[_.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",_[_.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",_[_.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",_[_.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",_[_.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",_[_.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",_[_.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",_[_.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",_[_.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",_[_.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",_[_.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",_[_.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",_[_.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",_[_.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",_[_.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",_[_.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",_[_.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",_[_.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",_[_.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",_[_.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",_[_.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",_[_.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",_[_.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",_[_.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",_[_.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",_[_.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",_[_.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",_[_.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",_[_.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",_[_.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",_[_.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",_[_.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",_[_.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",_[_.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",_[_.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",_[_.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",_[_.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",_[_.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",_[_.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",_[_.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",_[_.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",_[_.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",_[_.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",_[_.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",_[_.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",_[_.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",_[_.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",_[_.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",_[_.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",_[_.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",_[_.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",_[_.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",_[_.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",_[_.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",_[_.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",_[_.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",_[_.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",_[_.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",_[_.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",_[_.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",_[_.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",_[_.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",_[_.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",_[_.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",_[_.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",_[_.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",_[_.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",_[_.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",_[_.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",_[_.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",_[_.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",_[_.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",_[_.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",_[_.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",_[_.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",_[_.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",_[_.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",_[_.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",_[_.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",_[_.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",_[_.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",_[_.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",_[_.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",_[_.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",_[_.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",_[_.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",_[_.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",_[_.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",_[_.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",_[_.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",_[_.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",_[_.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",_[_.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",_[_.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(C||(C={})),function(_){_[_.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",_[_.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",_[_.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(s||(s={}));var v,p,w,m=((o={})[827611204]=M.COMPRESSED_RGBA_S3TC_DXT1_EXT,o[861165636]=M.COMPRESSED_RGBA_S3TC_DXT3_EXT,o[894720068]=M.COMPRESSED_RGBA_S3TC_DXT5_EXT,o),x=((a={})[C.DXGI_FORMAT_BC1_TYPELESS]=M.COMPRESSED_RGBA_S3TC_DXT1_EXT,a[C.DXGI_FORMAT_BC1_UNORM]=M.COMPRESSED_RGBA_S3TC_DXT1_EXT,a[C.DXGI_FORMAT_BC2_TYPELESS]=M.COMPRESSED_RGBA_S3TC_DXT3_EXT,a[C.DXGI_FORMAT_BC2_UNORM]=M.COMPRESSED_RGBA_S3TC_DXT3_EXT,a[C.DXGI_FORMAT_BC3_TYPELESS]=M.COMPRESSED_RGBA_S3TC_DXT5_EXT,a[C.DXGI_FORMAT_BC3_UNORM]=M.COMPRESSED_RGBA_S3TC_DXT5_EXT,a[C.DXGI_FORMAT_BC1_UNORM_SRGB]=M.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,a[C.DXGI_FORMAT_BC2_UNORM_SRGB]=M.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,a[C.DXGI_FORMAT_BC3_UNORM_SRGB]=M.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,a),Y=function(){function _(){}return _.use=function(R,e){if("dds"===R.extension&&R.data)try{Object.assign(R,P(R.name||R.url,_.parse(R.data),R.metadata))}catch(_){return void e(_)}e()},_.parse=function(_){var R=new Uint32Array(_);if(542327876!==R[0])throw new Error("Invalid DDS file magic word");var e=new Uint32Array(_,0,124/Uint32Array.BYTES_PER_ELEMENT),T=e[u],t=e[f],E=e[N],G=new Uint32Array(_,l*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),r=G[1];if(4&r){var O=G[U];if(808540228!==O){var A=m[O],D=new Uint8Array(_,128);return[new B(D,{format:A,width:t,height:T,levels:E})]}var M=new Uint32Array(R.buffer,128,20/Uint32Array.BYTES_PER_ELEMENT),n=M[c],I=M[L],X=M[d],o=M[h],a=x[n];if(void 0===a)throw new Error("DDSLoader cannot parse texture data with DXGI format "+n);if(4===X)throw new Error("DDSLoader does not support cubemap textures");if(I===s.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var F=new Array;if(1===o)F.push(new Uint8Array(_,148));else{for(var i=S[a],P=0,C=t,v=T,p=0;p<E;p++){P+=Math.max(1,C+3&-4)*Math.max(1,v+3&-4)*i,C>>>=1,v>>>=1}var w=148;for(p=0;p<o;p++)F.push(new Uint8Array(_,w,P)),w+=P}return F.map(function(_){return new B(_,{format:a,width:t,height:T,levels:E})})}if(64&r)throw new Error("DDSLoader does not support uncompressed texture data.");if(512&r)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(131072&r)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(2&r)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},_}();t.setExtensionXhrType("ktx",t.XHR_RESPONSE_TYPE.BUFFER);var y=[171,75,84,88,32,49,49,187,13,10,26,10],g=12,H=16,b=24,V=28,W=36,k=40,j=44,K=48,Q=52,J=56,q=60,z=((v={})[O.UNSIGNED_BYTE]=1,v[O.UNSIGNED_SHORT]=2,v[O.INT]=4,v[O.UNSIGNED_INT]=4,v[O.FLOAT]=4,v[O.HALF_FLOAT]=8,v),Z=((p={})[A.RGBA]=4,p[A.RGB]=3,p[A.RG]=2,p[A.RED]=1,p[A.LUMINANCE]=1,p[A.LUMINANCE_ALPHA]=2,p[A.ALPHA]=1,p),$=((w={})[O.UNSIGNED_SHORT_4_4_4_4]=2,w[O.UNSIGNED_SHORT_5_5_5_1]=2,w[O.UNSIGNED_SHORT_5_6_5]=2,w),__=function(){function _(){}return _.use=function(R,t){if("ktx"===R.extension&&R.data)try{var E=R.name||R.url,O=_.parse(E,R.data),A=O.compressed,D=O.uncompressed;if(A)Object.assign(R,P(E,A,R.metadata));else if(D){var M={};D.forEach(function(_,R){var t=new e(new T(_.resource,{mipmap:G.OFF,alphaMode:r.NO_PREMULTIPLIED_ALPHA,type:_.type,format:_.format})),O=E+"-"+(R+1);T.addToCache(t.baseTexture,O),e.addToCache(t,O),0===R&&(M[E]=t,T.addToCache(t.baseTexture,E),e.addToCache(t,E)),M[O]=t}),Object.assign(R,{textures:M})}}catch(_){return void t(_)}t()},_.parse=function(e,T){var t=new DataView(T);if(!_.validate(e,t))return null;var E=67305985===t.getUint32(g,!0),G=t.getUint32(H,E),r=t.getUint32(b,E),A=t.getUint32(V,E),D=t.getUint32(W,E),M=t.getUint32(k,E)||1,n=t.getUint32(j,E)||1,I=t.getUint32(K,E)||1,X=t.getUint32(Q,E),o=t.getUint32(J,E),a=t.getUint32(q,E);if(0===M||1!==n)throw new Error("Only 2D textures are supported");if(1!==X)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==I)throw new Error("WebGL does not support array textures");var F,i=D+3&-4,P=M+3&-4,C=new Array(I),s=D*M;if(0===G&&(s=i*P),void 0===(F=0!==G?z[G]?z[G]*Z[r]:$[G]:S[A]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var u=s*F,f=D,N=M,l=i,U=P,c=64+a,L=0;L<o;L++){for(var d=t.getUint32(c,E),h=c+4,v=0;v<I;v++){var p=C[v];p||(p=C[v]=new Array(o)),p[L]={levelID:L,levelWidth:o>1||0!==G?f:l,levelHeight:o>1||0!==G?N:U,levelBuffer:new Uint8Array(T,h,u)},h+=u}c=(c+=d+4)%4!=0?c+4-c%4:c,u=(l=(f=f>>1||1)+4-1&-4)*(U=(N=N>>1||1)+4-1&-4)*F}return 0!==G?{uncompressed:C.map(function(e){var T=e[0].levelBuffer,t=!1;return G===O.FLOAT?T=new Float32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4):G===O.UNSIGNED_INT?(t=!0,T=new Uint32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)):G===O.INT&&(t=!0,T=new Int32Array(e[0].levelBuffer.buffer,e[0].levelBuffer.byteOffset,e[0].levelBuffer.byteLength/4)),{resource:new R(T,{width:e[0].levelWidth,height:e[0].levelHeight}),type:G,format:t?_.convertFormatToInteger(r):r}})}:{compressed:C.map(function(_){return new B(null,{format:A,width:D,height:M,levels:o,levelBuffers:_})})}},_.validate=function(_,R){for(var e=0;e<y.length;e++)if(R.getUint8(e)!==y[e])return!1;return!0},_.convertFormatToInteger=function(_){switch(_){case A.RGBA:return A.RGBA_INTEGER;case A.RGB:return A.RGB_INTEGER;case A.RG:return A.RG_INTEGER;case A.RED:return A.RED_INTEGER;default:return _}},_}();export{F as BlobResource,i as CompressedTextureLoader,B as CompressedTextureResource,Y as DDSLoader,Z as FORMATS_TO_COMPONENTS,M as INTERNAL_FORMATS,S as INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,__ as KTXLoader,z as TYPES_TO_BYTES_PER_COMPONENT,$ as TYPES_TO_BYTES_PER_PIXEL};
//# sourceMappingURL=compressed-textures.min.js.map
