/*!
 * @pixi/compressed-textures - v6.3.0
 * Compiled Wed, 23 Mar 2022 18:58:56 UTC
 *
 * @pixi/compressed-textures is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _a,core=require("@pixi/core"),loaders=require("@pixi/loaders"),utils=require("@pixi/utils"),constants=require("@pixi/constants");!function(_){_[_.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",_[_.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",_[_.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",_[_.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",_[_.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",_[_.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",_[_.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",_[_.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",_[_.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",_[_.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",_[_.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",_[_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",_[_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",_[_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",_[_.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",_[_.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",_[_.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",_[_.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",_[_.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",_[_.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",_[_.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",_[_.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL"}(exports.INTERNAL_FORMATS||(exports.INTERNAL_FORMATS={}));var INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=((_a={})[exports.INTERNAL_FORMATS.COMPRESSED_RGB_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_R11_EAC]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SIGNED_R11_EAC]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RG11_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SIGNED_RG11_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB8_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA8_ETC2_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]=.25,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]=.25,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_ETC1_WEBGL]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGB_ATC_WEBGL]=.5,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL]=1,_a[exports.INTERNAL_FORMATS.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL]=1,_a),extendStatics=function(_,R){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,R){_.__proto__=R}||function(_,R){for(var e in R)R.hasOwnProperty(e)&&(_[e]=R[e])})(_,R)};function __extends(_,R){function e(){this.constructor=_}extendStatics(_,R),_.prototype=null===R?Object.create(R):(e.prototype=R.prototype,new e)}function __awaiter(_,R,e,T){return new(e||(e=Promise))(function(E,t){function A(_){try{r(T.next(_))}catch(_){t(_)}}function S(_){try{r(T.throw(_))}catch(_){t(_)}}function r(_){_.done?E(_.value):new e(function(R){R(_.value)}).then(A,S)}r((T=T.apply(_,R||[])).next())})}function __generator(_,R){var e,T,E,t,A={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return t={next:S(0),throw:S(1),return:S(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function S(t){return function(S){return function(t){if(e)throw new TypeError("Generator is already executing.");for(;A;)try{if(e=1,T&&(E=2&t[0]?T.return:t[0]?T.throw||((E=T.return)&&E.call(T),0):T.next)&&!(E=E.call(T,t[1])).done)return E;switch(T=0,E&&(t=[2&t[0],E.value]),t[0]){case 0:case 1:E=t;break;case 4:return A.label++,{value:t[1],done:!1};case 5:A.label++,T=t[1],t=[0];continue;case 7:t=A.ops.pop(),A.trys.pop();continue;default:if(!(E=(E=A.trys).length>0&&E[E.length-1])&&(6===t[0]||2===t[0])){A=0;continue}if(3===t[0]&&(!E||t[1]>E[0]&&t[1]<E[3])){A.label=t[1];break}if(6===t[0]&&A.label<E[1]){A.label=E[1],E=t;break}if(E&&A.label<E[2]){A.label=E[2],A.ops.push(t);break}E[2]&&A.ops.pop(),A.trys.pop();continue}t=R.call(_,A)}catch(_){t=[6,_],T=0}finally{e=E=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,S])}}}var _a$1,_b,BlobResource=function(_){function R(R,e){void 0===e&&(e={width:1,height:1,autoLoad:!0});var T,E,t=this;return"string"==typeof R?(T=R,E=new Uint8Array):(T=null,E=R),(t=_.call(this,E,e)||this).origin=T,t.buffer=E?new core.ViewableBuffer(E):null,t.origin&&!1!==e.autoLoad&&t.load(),E&&E.length&&(t.loaded=!0,t.onBlobLoaded(t.buffer.rawBinaryData)),t}return __extends(R,_),R.prototype.onBlobLoaded=function(_){},R.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var _;return __generator(this,function(R){switch(R.label){case 0:return[4,fetch(this.origin)];case 1:return[4,R.sent().blob()];case 2:return[4,R.sent().arrayBuffer()];case 3:return _=R.sent(),this.data=new Uint32Array(_),this.buffer=new core.ViewableBuffer(_),this.loaded=!0,this.onBlobLoaded(_),this.update(),[2,this]}})})},R}(core.BufferResource),CompressedTextureResource=function(_){function R(e,T){var E=_.call(this,e,T)||this;return E.format=T.format,E.levels=T.levels||1,E._width=T.width,E._height=T.height,E._extension=R._formatToExtension(E.format),(T.levelBuffers||E.buffer)&&(E._levelBuffers=T.levelBuffers||R._createLevelBuffers(e instanceof Uint8Array?e:E.buffer.uint8View,E.format,E.levels,4,4,E.width,E.height)),E}return __extends(R,_),R.prototype.upload=function(_,R,e){var T=_.gl;if(!_.context.extensions[this._extension])throw new Error(this._extension+" textures are not supported on the current machine");if(!this._levelBuffers)return!1;for(var E=0,t=this.levels;E<t;E++){var A=this._levelBuffers[E],S=A.levelID,r=A.levelWidth,O=A.levelHeight,D=A.levelBuffer;T.compressedTexImage2D(T.TEXTURE_2D,S,this.format,r,O,0,D)}return!0},R.prototype.onBlobLoaded=function(){this._levelBuffers=R._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)},R._formatToExtension=function(_){if(_>=33776&&_<=33779)return"s3tc";if(_>=37488&&_<=37497)return"etc";if(_>=35840&&_<=35843)return"pvrtc";if(_>=36196)return"etc1";if(_>=35986&&_<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")},R._createLevelBuffers=function(_,R,e,T,E,t,A){for(var S=new Array(e),r=_.byteOffset,O=t,D=A,M=O+T-1&~(T-1),I=D+E-1&~(E-1),G=M*I*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[R],o=0;o<e;o++)S[o]={levelID:o,levelWidth:e>1?O:M,levelHeight:e>1?D:I,levelBuffer:new Uint8Array(_.buffer,r,G)},r+=G,G=(M=(O=O>>1||1)+T-1&~(T-1))*(I=(D=D>>1||1)+E-1&~(E-1))*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[R];return S},R}(BlobResource),CompressedTextureLoader=function(){function _(){}return _.use=function(R,e){var T=R.data;if(R.type===loaders.LoaderResource.TYPE.JSON&&T&&T.cacheID&&T.textures){for(var E=T.textures,t=void 0,A=void 0,S=0,r=E.length;S<r;S++){var O=E[S],D=O.src,M=O.format;if(M||(A=D),_.textureFormats[M]){t=D;break}}if(!(t=t||A))return void e(new Error("Cannot load compressed-textures in "+R.url+", make sure you provide a fallback"));if(t===R.url)return void e(new Error("URL of compressed texture cannot be the same as the manifest's URL"));var I={crossOrigin:R.crossOrigin,metadata:R.metadata.imageMetadata,parentResource:R},G=utils.url.resolve(R.url.replace(this.baseUrl,""),t),o=T.cacheID;this.add(o,G,I,function(_){if(_.error)e(_.error);else{var T=_.texture,E=void 0===T?null:T,t=_.textures,A=void 0===t?{}:t;Object.assign(R,{texture:E,textures:A}),e()}})}else e()},_.add=function(){var R=document.createElement("canvas").getContext("webgl");if(R){var e={s3tc:R.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:R.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:R.getExtension("WEBGL_compressed_texture_etc"),etc1:R.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:R.getExtension("WEBGL_compressed_texture_pvrtc")||R.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:R.getExtension("WEBGL_compressed_texture_atc"),astc:R.getExtension("WEBGL_compressed_texture_astc")};for(var T in _.textureExtensions=e,_.textureFormats={},e){var E=e[T];E&&Object.assign(_.textureFormats,Object.getPrototypeOf(E))}}},_}();function registerCompressedTextures(_,R,e){var T={textures:{},texture:null};return R?(R.map(function(_){return new core.Texture(new core.BaseTexture(_,Object.assign({mipmap:constants.MIPMAP_MODES.OFF,alphaMode:constants.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA},e)))}).forEach(function(R,e){var E=R.baseTexture,t=_+"-"+(e+1);core.BaseTexture.addToCache(E,t),core.Texture.addToCache(R,t),0===e&&(core.BaseTexture.addToCache(E,_),core.Texture.addToCache(R,_),T.texture=R),T.textures[t]=R}),T):T}loaders.LoaderResource.setExtensionXhrType("dds",loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var DXGI_FORMAT,D3D10_RESOURCE_DIMENSION,DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4};!function(_){_[_.DXGI_FORMAT_UNKNOWN=0]="DXGI_FORMAT_UNKNOWN",_[_.DXGI_FORMAT_R32G32B32A32_TYPELESS=1]="DXGI_FORMAT_R32G32B32A32_TYPELESS",_[_.DXGI_FORMAT_R32G32B32A32_FLOAT=2]="DXGI_FORMAT_R32G32B32A32_FLOAT",_[_.DXGI_FORMAT_R32G32B32A32_UINT=3]="DXGI_FORMAT_R32G32B32A32_UINT",_[_.DXGI_FORMAT_R32G32B32A32_SINT=4]="DXGI_FORMAT_R32G32B32A32_SINT",_[_.DXGI_FORMAT_R32G32B32_TYPELESS=5]="DXGI_FORMAT_R32G32B32_TYPELESS",_[_.DXGI_FORMAT_R32G32B32_FLOAT=6]="DXGI_FORMAT_R32G32B32_FLOAT",_[_.DXGI_FORMAT_R32G32B32_UINT=7]="DXGI_FORMAT_R32G32B32_UINT",_[_.DXGI_FORMAT_R32G32B32_SINT=8]="DXGI_FORMAT_R32G32B32_SINT",_[_.DXGI_FORMAT_R16G16B16A16_TYPELESS=9]="DXGI_FORMAT_R16G16B16A16_TYPELESS",_[_.DXGI_FORMAT_R16G16B16A16_FLOAT=10]="DXGI_FORMAT_R16G16B16A16_FLOAT",_[_.DXGI_FORMAT_R16G16B16A16_UNORM=11]="DXGI_FORMAT_R16G16B16A16_UNORM",_[_.DXGI_FORMAT_R16G16B16A16_UINT=12]="DXGI_FORMAT_R16G16B16A16_UINT",_[_.DXGI_FORMAT_R16G16B16A16_SNORM=13]="DXGI_FORMAT_R16G16B16A16_SNORM",_[_.DXGI_FORMAT_R16G16B16A16_SINT=14]="DXGI_FORMAT_R16G16B16A16_SINT",_[_.DXGI_FORMAT_R32G32_TYPELESS=15]="DXGI_FORMAT_R32G32_TYPELESS",_[_.DXGI_FORMAT_R32G32_FLOAT=16]="DXGI_FORMAT_R32G32_FLOAT",_[_.DXGI_FORMAT_R32G32_UINT=17]="DXGI_FORMAT_R32G32_UINT",_[_.DXGI_FORMAT_R32G32_SINT=18]="DXGI_FORMAT_R32G32_SINT",_[_.DXGI_FORMAT_R32G8X24_TYPELESS=19]="DXGI_FORMAT_R32G8X24_TYPELESS",_[_.DXGI_FORMAT_D32_FLOAT_S8X24_UINT=20]="DXGI_FORMAT_D32_FLOAT_S8X24_UINT",_[_.DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS=21]="DXGI_FORMAT_R32_FLOAT_X8X24_TYPELESS",_[_.DXGI_FORMAT_X32_TYPELESS_G8X24_UINT=22]="DXGI_FORMAT_X32_TYPELESS_G8X24_UINT",_[_.DXGI_FORMAT_R10G10B10A2_TYPELESS=23]="DXGI_FORMAT_R10G10B10A2_TYPELESS",_[_.DXGI_FORMAT_R10G10B10A2_UNORM=24]="DXGI_FORMAT_R10G10B10A2_UNORM",_[_.DXGI_FORMAT_R10G10B10A2_UINT=25]="DXGI_FORMAT_R10G10B10A2_UINT",_[_.DXGI_FORMAT_R11G11B10_FLOAT=26]="DXGI_FORMAT_R11G11B10_FLOAT",_[_.DXGI_FORMAT_R8G8B8A8_TYPELESS=27]="DXGI_FORMAT_R8G8B8A8_TYPELESS",_[_.DXGI_FORMAT_R8G8B8A8_UNORM=28]="DXGI_FORMAT_R8G8B8A8_UNORM",_[_.DXGI_FORMAT_R8G8B8A8_UNORM_SRGB=29]="DXGI_FORMAT_R8G8B8A8_UNORM_SRGB",_[_.DXGI_FORMAT_R8G8B8A8_UINT=30]="DXGI_FORMAT_R8G8B8A8_UINT",_[_.DXGI_FORMAT_R8G8B8A8_SNORM=31]="DXGI_FORMAT_R8G8B8A8_SNORM",_[_.DXGI_FORMAT_R8G8B8A8_SINT=32]="DXGI_FORMAT_R8G8B8A8_SINT",_[_.DXGI_FORMAT_R16G16_TYPELESS=33]="DXGI_FORMAT_R16G16_TYPELESS",_[_.DXGI_FORMAT_R16G16_FLOAT=34]="DXGI_FORMAT_R16G16_FLOAT",_[_.DXGI_FORMAT_R16G16_UNORM=35]="DXGI_FORMAT_R16G16_UNORM",_[_.DXGI_FORMAT_R16G16_UINT=36]="DXGI_FORMAT_R16G16_UINT",_[_.DXGI_FORMAT_R16G16_SNORM=37]="DXGI_FORMAT_R16G16_SNORM",_[_.DXGI_FORMAT_R16G16_SINT=38]="DXGI_FORMAT_R16G16_SINT",_[_.DXGI_FORMAT_R32_TYPELESS=39]="DXGI_FORMAT_R32_TYPELESS",_[_.DXGI_FORMAT_D32_FLOAT=40]="DXGI_FORMAT_D32_FLOAT",_[_.DXGI_FORMAT_R32_FLOAT=41]="DXGI_FORMAT_R32_FLOAT",_[_.DXGI_FORMAT_R32_UINT=42]="DXGI_FORMAT_R32_UINT",_[_.DXGI_FORMAT_R32_SINT=43]="DXGI_FORMAT_R32_SINT",_[_.DXGI_FORMAT_R24G8_TYPELESS=44]="DXGI_FORMAT_R24G8_TYPELESS",_[_.DXGI_FORMAT_D24_UNORM_S8_UINT=45]="DXGI_FORMAT_D24_UNORM_S8_UINT",_[_.DXGI_FORMAT_R24_UNORM_X8_TYPELESS=46]="DXGI_FORMAT_R24_UNORM_X8_TYPELESS",_[_.DXGI_FORMAT_X24_TYPELESS_G8_UINT=47]="DXGI_FORMAT_X24_TYPELESS_G8_UINT",_[_.DXGI_FORMAT_R8G8_TYPELESS=48]="DXGI_FORMAT_R8G8_TYPELESS",_[_.DXGI_FORMAT_R8G8_UNORM=49]="DXGI_FORMAT_R8G8_UNORM",_[_.DXGI_FORMAT_R8G8_UINT=50]="DXGI_FORMAT_R8G8_UINT",_[_.DXGI_FORMAT_R8G8_SNORM=51]="DXGI_FORMAT_R8G8_SNORM",_[_.DXGI_FORMAT_R8G8_SINT=52]="DXGI_FORMAT_R8G8_SINT",_[_.DXGI_FORMAT_R16_TYPELESS=53]="DXGI_FORMAT_R16_TYPELESS",_[_.DXGI_FORMAT_R16_FLOAT=54]="DXGI_FORMAT_R16_FLOAT",_[_.DXGI_FORMAT_D16_UNORM=55]="DXGI_FORMAT_D16_UNORM",_[_.DXGI_FORMAT_R16_UNORM=56]="DXGI_FORMAT_R16_UNORM",_[_.DXGI_FORMAT_R16_UINT=57]="DXGI_FORMAT_R16_UINT",_[_.DXGI_FORMAT_R16_SNORM=58]="DXGI_FORMAT_R16_SNORM",_[_.DXGI_FORMAT_R16_SINT=59]="DXGI_FORMAT_R16_SINT",_[_.DXGI_FORMAT_R8_TYPELESS=60]="DXGI_FORMAT_R8_TYPELESS",_[_.DXGI_FORMAT_R8_UNORM=61]="DXGI_FORMAT_R8_UNORM",_[_.DXGI_FORMAT_R8_UINT=62]="DXGI_FORMAT_R8_UINT",_[_.DXGI_FORMAT_R8_SNORM=63]="DXGI_FORMAT_R8_SNORM",_[_.DXGI_FORMAT_R8_SINT=64]="DXGI_FORMAT_R8_SINT",_[_.DXGI_FORMAT_A8_UNORM=65]="DXGI_FORMAT_A8_UNORM",_[_.DXGI_FORMAT_R1_UNORM=66]="DXGI_FORMAT_R1_UNORM",_[_.DXGI_FORMAT_R9G9B9E5_SHAREDEXP=67]="DXGI_FORMAT_R9G9B9E5_SHAREDEXP",_[_.DXGI_FORMAT_R8G8_B8G8_UNORM=68]="DXGI_FORMAT_R8G8_B8G8_UNORM",_[_.DXGI_FORMAT_G8R8_G8B8_UNORM=69]="DXGI_FORMAT_G8R8_G8B8_UNORM",_[_.DXGI_FORMAT_BC1_TYPELESS=70]="DXGI_FORMAT_BC1_TYPELESS",_[_.DXGI_FORMAT_BC1_UNORM=71]="DXGI_FORMAT_BC1_UNORM",_[_.DXGI_FORMAT_BC1_UNORM_SRGB=72]="DXGI_FORMAT_BC1_UNORM_SRGB",_[_.DXGI_FORMAT_BC2_TYPELESS=73]="DXGI_FORMAT_BC2_TYPELESS",_[_.DXGI_FORMAT_BC2_UNORM=74]="DXGI_FORMAT_BC2_UNORM",_[_.DXGI_FORMAT_BC2_UNORM_SRGB=75]="DXGI_FORMAT_BC2_UNORM_SRGB",_[_.DXGI_FORMAT_BC3_TYPELESS=76]="DXGI_FORMAT_BC3_TYPELESS",_[_.DXGI_FORMAT_BC3_UNORM=77]="DXGI_FORMAT_BC3_UNORM",_[_.DXGI_FORMAT_BC3_UNORM_SRGB=78]="DXGI_FORMAT_BC3_UNORM_SRGB",_[_.DXGI_FORMAT_BC4_TYPELESS=79]="DXGI_FORMAT_BC4_TYPELESS",_[_.DXGI_FORMAT_BC4_UNORM=80]="DXGI_FORMAT_BC4_UNORM",_[_.DXGI_FORMAT_BC4_SNORM=81]="DXGI_FORMAT_BC4_SNORM",_[_.DXGI_FORMAT_BC5_TYPELESS=82]="DXGI_FORMAT_BC5_TYPELESS",_[_.DXGI_FORMAT_BC5_UNORM=83]="DXGI_FORMAT_BC5_UNORM",_[_.DXGI_FORMAT_BC5_SNORM=84]="DXGI_FORMAT_BC5_SNORM",_[_.DXGI_FORMAT_B5G6R5_UNORM=85]="DXGI_FORMAT_B5G6R5_UNORM",_[_.DXGI_FORMAT_B5G5R5A1_UNORM=86]="DXGI_FORMAT_B5G5R5A1_UNORM",_[_.DXGI_FORMAT_B8G8R8A8_UNORM=87]="DXGI_FORMAT_B8G8R8A8_UNORM",_[_.DXGI_FORMAT_B8G8R8X8_UNORM=88]="DXGI_FORMAT_B8G8R8X8_UNORM",_[_.DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM=89]="DXGI_FORMAT_R10G10B10_XR_BIAS_A2_UNORM",_[_.DXGI_FORMAT_B8G8R8A8_TYPELESS=90]="DXGI_FORMAT_B8G8R8A8_TYPELESS",_[_.DXGI_FORMAT_B8G8R8A8_UNORM_SRGB=91]="DXGI_FORMAT_B8G8R8A8_UNORM_SRGB",_[_.DXGI_FORMAT_B8G8R8X8_TYPELESS=92]="DXGI_FORMAT_B8G8R8X8_TYPELESS",_[_.DXGI_FORMAT_B8G8R8X8_UNORM_SRGB=93]="DXGI_FORMAT_B8G8R8X8_UNORM_SRGB",_[_.DXGI_FORMAT_BC6H_TYPELESS=94]="DXGI_FORMAT_BC6H_TYPELESS",_[_.DXGI_FORMAT_BC6H_UF16=95]="DXGI_FORMAT_BC6H_UF16",_[_.DXGI_FORMAT_BC6H_SF16=96]="DXGI_FORMAT_BC6H_SF16",_[_.DXGI_FORMAT_BC7_TYPELESS=97]="DXGI_FORMAT_BC7_TYPELESS",_[_.DXGI_FORMAT_BC7_UNORM=98]="DXGI_FORMAT_BC7_UNORM",_[_.DXGI_FORMAT_BC7_UNORM_SRGB=99]="DXGI_FORMAT_BC7_UNORM_SRGB",_[_.DXGI_FORMAT_AYUV=100]="DXGI_FORMAT_AYUV",_[_.DXGI_FORMAT_Y410=101]="DXGI_FORMAT_Y410",_[_.DXGI_FORMAT_Y416=102]="DXGI_FORMAT_Y416",_[_.DXGI_FORMAT_NV12=103]="DXGI_FORMAT_NV12",_[_.DXGI_FORMAT_P010=104]="DXGI_FORMAT_P010",_[_.DXGI_FORMAT_P016=105]="DXGI_FORMAT_P016",_[_.DXGI_FORMAT_420_OPAQUE=106]="DXGI_FORMAT_420_OPAQUE",_[_.DXGI_FORMAT_YUY2=107]="DXGI_FORMAT_YUY2",_[_.DXGI_FORMAT_Y210=108]="DXGI_FORMAT_Y210",_[_.DXGI_FORMAT_Y216=109]="DXGI_FORMAT_Y216",_[_.DXGI_FORMAT_NV11=110]="DXGI_FORMAT_NV11",_[_.DXGI_FORMAT_AI44=111]="DXGI_FORMAT_AI44",_[_.DXGI_FORMAT_IA44=112]="DXGI_FORMAT_IA44",_[_.DXGI_FORMAT_P8=113]="DXGI_FORMAT_P8",_[_.DXGI_FORMAT_A8P8=114]="DXGI_FORMAT_A8P8",_[_.DXGI_FORMAT_B4G4R4A4_UNORM=115]="DXGI_FORMAT_B4G4R4A4_UNORM",_[_.DXGI_FORMAT_P208=116]="DXGI_FORMAT_P208",_[_.DXGI_FORMAT_V208=117]="DXGI_FORMAT_V208",_[_.DXGI_FORMAT_V408=118]="DXGI_FORMAT_V408",_[_.DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE=119]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIN_MIP_OPAQUE",_[_.DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE=120]="DXGI_FORMAT_SAMPLER_FEEDBACK_MIP_REGION_USED_OPAQUE",_[_.DXGI_FORMAT_FORCE_UINT=121]="DXGI_FORMAT_FORCE_UINT"}(DXGI_FORMAT||(DXGI_FORMAT={})),function(_){_[_.DDS_DIMENSION_TEXTURE1D=2]="DDS_DIMENSION_TEXTURE1D",_[_.DDS_DIMENSION_TEXTURE2D=3]="DDS_DIMENSION_TEXTURE2D",_[_.DDS_DIMENSION_TEXTURE3D=6]="DDS_DIMENSION_TEXTURE3D"}(D3D10_RESOURCE_DIMENSION||(D3D10_RESOURCE_DIMENSION={}));var _a$2,_b$1,_c,PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT=((_a$1={})[FOURCC_DXT1]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_a$1[FOURCC_DXT3]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_a$1[FOURCC_DXT5]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_a$1),DXGI_TO_FORMAT=((_b={})[DXGI_FORMAT.DXGI_FORMAT_BC1_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_TYPELESS]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM]=exports.INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC1_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC2_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,_b[DXGI_FORMAT.DXGI_FORMAT_BC3_UNORM_SRGB]=exports.INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,_b),DDSLoader=function(){function _(){}return _.use=function(R,e){if("dds"===R.extension&&R.data)try{Object.assign(R,registerCompressedTextures(R.name||R.url,_.parse(R.data),R.metadata))}catch(_){return void e(_)}e()},_.parse=function(_){var R=new Uint32Array(_);if(R[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");var e=new Uint32Array(_,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),T=e[DDS_FIELDS.HEIGHT],E=e[DDS_FIELDS.WIDTH],t=e[DDS_FIELDS.MIPMAP_COUNT],A=new Uint32Array(_,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),S=A[PF_FLAGS];if(S&DDPF_FOURCC){var r=A[DDS_PF_FIELDS.FOURCC];if(r!==FOURCC_DX10){var O=FOURCC_TO_FORMAT[r],D=new Uint8Array(_,DDS_MAGIC_SIZE+DDS_HEADER_SIZE);return[new CompressedTextureResource(D,{format:O,width:E,height:T,levels:t})]}var M=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,I=new Uint32Array(R.buffer,M,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),G=I[DDS_DX10_FIELDS.DXGI_FORMAT],o=I[DDS_DX10_FIELDS.RESOURCE_DIMENSION],n=I[DDS_DX10_FIELDS.MISC_FLAG],F=I[DDS_DX10_FIELDS.ARRAY_SIZE],X=DXGI_TO_FORMAT[G];if(void 0===X)throw new Error("DDSLoader cannot parse texture data with DXGI format "+G);if(n===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSLoader does not support cubemap textures");if(o===D3D10_RESOURCE_DIMENSION.DDS_DIMENSION_TEXTURE3D)throw new Error("DDSLoader does not supported 3D texture data");var a=new Array,s=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(1===F)a.push(new Uint8Array(_,s));else{for(var N=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[X],P=0,B=E,C=T,L=0;L<t;L++){P+=Math.max(1,B+3&-4)*Math.max(1,C+3&-4)*N,B>>>=1,C>>>=1}var i=s;for(L=0;L<F;L++)a.push(new Uint8Array(_,i,P)),i+=P}return a.map(function(_){return new CompressedTextureResource(_,{format:X,width:E,height:T,levels:t})})}if(S&DDPF_RGB)throw new Error("DDSLoader does not support uncompressed texture data.");if(S&DDPF_YUV)throw new Error("DDSLoader does not supported YUV uncompressed texture data.");if(S&DDPF_LUMINANCE)throw new Error("DDSLoader does not support single-channel (lumninance) texture data!");if(S&DDPF_ALPHA)throw new Error("DDSLoader does not support single-channel (alpha) texture data!");throw new Error("DDSLoader failed to load a texture file due to an unknown reason!")},_}();loaders.LoaderResource.setExtensionXhrType("ktx",loaders.LoaderResource.XHR_RESPONSE_TYPE.BUFFER);var FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT=((_a$2={})[constants.TYPES.UNSIGNED_BYTE]=1,_a$2[constants.TYPES.UNSIGNED_SHORT]=2,_a$2[constants.TYPES.INT]=4,_a$2[constants.TYPES.UNSIGNED_INT]=4,_a$2[constants.TYPES.FLOAT]=4,_a$2[constants.TYPES.HALF_FLOAT]=8,_a$2),FORMATS_TO_COMPONENTS=((_b$1={})[constants.FORMATS.RGBA]=4,_b$1[constants.FORMATS.RGB]=3,_b$1[constants.FORMATS.RG]=2,_b$1[constants.FORMATS.RED]=1,_b$1[constants.FORMATS.LUMINANCE]=1,_b$1[constants.FORMATS.LUMINANCE_ALPHA]=2,_b$1[constants.FORMATS.ALPHA]=1,_b$1),TYPES_TO_BYTES_PER_PIXEL=((_c={})[constants.TYPES.UNSIGNED_SHORT_4_4_4_4]=2,_c[constants.TYPES.UNSIGNED_SHORT_5_5_5_1]=2,_c[constants.TYPES.UNSIGNED_SHORT_5_6_5]=2,_c),KTXLoader=function(){function _(){}return _.use=function(R,e){if("ktx"===R.extension&&R.data)try{var T=R.name||R.url,E=_.parse(T,R.data),t=E.compressed,A=E.uncompressed;if(t)Object.assign(R,registerCompressedTextures(T,t,R.metadata));else if(A){var S={};A.forEach(function(_,R){var e=new core.Texture(new core.BaseTexture(_.resource,{mipmap:constants.MIPMAP_MODES.OFF,alphaMode:constants.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,type:_.type,format:_.format})),E=T+"-"+(R+1);core.BaseTexture.addToCache(e.baseTexture,E),core.Texture.addToCache(e,E),0===R&&(S[T]=e,core.BaseTexture.addToCache(e.baseTexture,T),core.Texture.addToCache(e,T)),S[E]=e}),Object.assign(R,{textures:S})}}catch(_){return void e(_)}e()},_.parse=function(R,e){var T=new DataView(e);if(!_.validate(R,T))return null;var E=T.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,t=T.getUint32(KTX_FIELDS.GL_TYPE,E),A=T.getUint32(KTX_FIELDS.GL_FORMAT,E),S=T.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,E),r=T.getUint32(KTX_FIELDS.PIXEL_WIDTH,E),O=T.getUint32(KTX_FIELDS.PIXEL_HEIGHT,E)||1,D=T.getUint32(KTX_FIELDS.PIXEL_DEPTH,E)||1,M=T.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,E)||1,I=T.getUint32(KTX_FIELDS.NUMBER_OF_FACES,E),G=T.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,E),o=T.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,E);if(0===O||1!==D)throw new Error("Only 2D textures are supported");if(1!==I)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==M)throw new Error("WebGL does not support array textures");var n,F=r+3&-4,X=O+3&-4,a=new Array(M),s=r*O;if(0===t&&(s=F*X),void 0===(n=0!==t?TYPES_TO_BYTES_PER_COMPONENT[t]?TYPES_TO_BYTES_PER_COMPONENT[t]*FORMATS_TO_COMPONENTS[A]:TYPES_TO_BYTES_PER_PIXEL[t]:INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[S]))throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");for(var N=s*n,P=r,B=O,C=F,L=X,i=FILE_HEADER_SIZE+o,u=0;u<G;u++){for(var c=T.getUint32(i,E),f=i+4,U=0;U<M;U++){var l=a[U];l||(l=a[U]=new Array(G)),l[u]={levelID:u,levelWidth:G>1||0!==t?P:C,levelHeight:G>1||0!==t?B:L,levelBuffer:new Uint8Array(e,f,N)},f+=N}i=(i+=c+4)%4!=0?i+4-i%4:i,N=(C=(P=P>>1||1)+4-1&-4)*(L=(B=B>>1||1)+4-1&-4)*n}return 0!==t?{uncompressed:a.map(function(R){var e=R[0].levelBuffer,T=!1;return t===constants.TYPES.FLOAT?e=new Float32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4):t===constants.TYPES.UNSIGNED_INT?(T=!0,e=new Uint32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)):t===constants.TYPES.INT&&(T=!0,e=new Int32Array(R[0].levelBuffer.buffer,R[0].levelBuffer.byteOffset,R[0].levelBuffer.byteLength/4)),{resource:new core.BufferResource(e,{width:R[0].levelWidth,height:R[0].levelHeight}),type:t,format:T?_.convertFormatToInteger(A):A}})}:{compressed:a.map(function(_){return new CompressedTextureResource(null,{format:S,width:r,height:O,levels:G,levelBuffers:_})})}},_.validate=function(_,R){for(var e=0;e<FILE_IDENTIFIER.length;e++)if(R.getUint8(e)!==FILE_IDENTIFIER[e])return!1;return!0},_.convertFormatToInteger=function(_){switch(_){case constants.FORMATS.RGBA:return constants.FORMATS.RGBA_INTEGER;case constants.FORMATS.RGB:return constants.FORMATS.RGB_INTEGER;case constants.FORMATS.RG:return constants.FORMATS.RG_INTEGER;case constants.FORMATS.RED:return constants.FORMATS.RED_INTEGER;default:return _}},_}();exports.BlobResource=BlobResource,exports.CompressedTextureLoader=CompressedTextureLoader,exports.CompressedTextureResource=CompressedTextureResource,exports.DDSLoader=DDSLoader,exports.FORMATS_TO_COMPONENTS=FORMATS_TO_COMPONENTS,exports.INTERNAL_FORMAT_TO_BYTES_PER_PIXEL=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL,exports.KTXLoader=KTXLoader,exports.TYPES_TO_BYTES_PER_COMPONENT=TYPES_TO_BYTES_PER_COMPONENT,exports.TYPES_TO_BYTES_PER_PIXEL=TYPES_TO_BYTES_PER_PIXEL;
//# sourceMappingURL=compressed-textures.min.js.map
